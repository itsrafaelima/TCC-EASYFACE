<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EASYFACE - Interface Acess√≠vel</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Pular para o conte√∫do principal</a>
    
    <div class="header">
        <h1>üíª EASYFACE</h1>
        <div class="instructions">
            üìù Use TAB para navegar | ENTER ou ESPA√áO para ativar | ESC para voltar | Setas para mover
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <h2>üéØ Menu Principal</h2>
            <button class="menu-button scannable" onclick="showTextEditor()" tabindex="1" aria-label="Abrir Editor de Texto">
                üìù Editor de Texto
            </button>
            <button class="menu-button scannable" onclick="showCalculator()" tabindex="2" aria-label="Abrir Calculadora">
                üî¢ Calculadora
            </button>
            <button class="menu-button scannable" onclick="showVirtualKeyboard()" tabindex="3" aria-label="Abrir Teclado Virtual">
                ‚å®Ô∏è Teclado Virtual
            </button>
            <button class="menu-button scannable" onclick="showWebBrowser()" tabindex="4" aria-label="Abrir Navegador Web">
                üåê Navegador Web
            </button>
            <button class="menu-button scannable" onclick="showAccessibilitySettings()" tabindex="5" aria-label="Abrir Configura√ß√µes de Acessibilidade">
                ‚öôÔ∏è Configura√ß√µes
            </button>
            <button class="menu-button scannable" onclick="showHelp()" tabindex="6" aria-label="Abrir Ajuda">
                ‚ùì Ajuda
            </button>
        </div>

        <div class="content-area" id="main-content" tabindex="-1">
            <div id="text-editor" class="hidden">
                <h2>üìù Editor de Texto</h2>
                <textarea id="text-area" class="text-input scannable" rows="10" 
                    placeholder="Digite seu texto aqui... Use TAB para navegar pelos bot√µes abaixo."
                    tabindex="7" aria-label="√Årea de edi√ß√£o de texto"></textarea>
                <button class="action-button scannable" onclick="saveText()" tabindex="8" aria-label="Salvar texto">üíæ Salvar Texto</button>
                <button class="action-button scannable" onclick="clearText()" tabindex="9" aria-label="Limpar texto">üóëÔ∏è Limpar</button>
                <button class="action-button scannable" onclick="speakText()" tabindex="10" aria-label="Ler texto em voz alta">üîä Ler Texto</button>
            </div>

            <div id="calculator-app" class="hidden">
                <h2>üî¢ Calculadora</h2>
                <div class="calc-display" id="calc-display" aria-live="polite">0</div>
                <div class="calculator" id="calculator-grid">
                    <button class="calc-button scannable" onclick="clearCalc()" tabindex="11" data-key="Escape">C</button>
                    <button class="calc-button scannable" onclick="deleteLast()" tabindex="12" data-key="Backspace">‚å´</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('/')" tabindex="13" data-key="/">√∑</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('*')" tabindex="14" data-key="*">√ó</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('7')" tabindex="15" data-key="7">7</button>
                    <button class="calc-button scannable" onclick="addToCalc('8')" tabindex="16" data-key="8">8</button>
                    <button class="calc-button scannable" onclick="addToCalc('9')" tabindex="17" data-key="9">9</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('-')" tabindex="18" data-key="-">-</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('4')" tabindex="19" data-key="4">4</button>
                    <button class="calc-button scannable" onclick="addToCalc('5')" tabindex="20" data-key="5">5</button>
                    <button class="calc-button scannable" onclick="addToCalc('6')" tabindex="21" data-key="6">6</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('+')" tabindex="22" data-key="+">+</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('1')" tabindex="23" data-key="1">1</button>
                    <button class="calc-button scannable" onclick="addToCalc('2')" tabindex="24" data-key="2">2</button>
                    <button class="calc-button scannable" onclick="addToCalc('3')" tabindex="25" data-key="3">3</button>
                    <button class="calc-button equals scannable" onclick="calculateResult()" tabindex="26" data-key="Enter">=</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('0')" tabindex="27" style="grid-column: span 2;" data-key="0">0</button>
                    <button class="calc-button scannable" onclick="addToCalc('.')" tabindex="28" data-key=".">.</button>
                </div>
            </div>

            <div id="virtual-keyboard-app" class="hidden">
                <h2>‚å®Ô∏è Teclado Virtual</h2>
                <input type="text" id="keyboard-input" class="text-input scannable" 
                    placeholder="O texto digitado aparecer√° aqui..." tabindex="29" aria-label="Entrada do teclado virtual">
                <div class="virtual-keyboard">
                    <button class="key scannable" onclick="typeKey('1')" tabindex="30" aria-label="Tecla 1">1</button>
                    <button class="key scannable" onclick="typeKey('2')" tabindex="31" aria-label="Tecla 2">2</button>
                    <button class="key scannable" onclick="typeKey('3')" tabindex="32" aria-label="Tecla 3">3</button>
                    <button class="key scannable" onclick="typeKey('4')" tabindex="33" aria-label="Tecla 4">4</button>
                    <button class="key scannable" onclick="typeKey('5')" tabindex="34" aria-label="Tecla 5">5</button>
                    <button class="key scannable" onclick="typeKey('6')" tabindex="35" aria-label="Tecla 6">6</button>
                    <button class="key scannable" onclick="typeKey('7')" tabindex="36" aria-label="Tecla 7">7</button>
                    <button class="key scannable" onclick="typeKey('8')" tabindex="37" aria-label="Tecla 8">8</button>
                    <button class="key scannable" onclick="typeKey('9')" tabindex="38" aria-label="Tecla 9">9</button>
                    <button class="key scannable" onclick="typeKey('0')" tabindex="39" aria-label="Tecla 0">0</button>
                    
                    <button class="key scannable" onclick="typeKey('Q')" tabindex="40" aria-label="Tecla Q">Q</button>
                    <button class="key scannable" onclick="typeKey('W')" tabindex="41" aria-label="Tecla W">W</button>
                    <button class="key scannable" onclick="typeKey('E')" tabindex="42" aria-label="Tecla E">E</button>
                    <button class="key scannable" onclick="typeKey('R')" tabindex="43" aria-label="Tecla R">R</button>
                    <button class="key scannable" onclick="typeKey('T')" tabindex="44" aria-label="Tecla T">T</button>
                    <button class="key scannable" onclick="typeKey('Y')" tabindex="45" aria-label="Tecla Y">Y</button>
                    <button class="key scannable" onclick="typeKey('U')" tabindex="46" aria-label="Tecla U">U</button>
                    <button class="key scannable" onclick="typeKey('I')" tabindex="47" aria-label="Tecla I">I</button>
                    <button class="key scannable" onclick="typeKey('O')" tabindex="48" aria-label="Tecla O">O</button>
                    <button class="key scannable" onclick="typeKey('P')" tabindex="49" aria-label="Tecla P">P</button>
                    
                    <button class="key scannable" onclick="typeKey('A')" tabindex="50" aria-label="Tecla A">A</button>
                    <button class="key scannable" onclick="typeKey('S')" tabindex="51" aria-label="Tecla S">S</button>
                    <button class="key scannable" onclick="typeKey('D')" tabindex="52" aria-label="Tecla D">D</button>
                    <button class="key scannable" onclick="typeKey('F')" tabindex="53" aria-label="Tecla F">F</button>
                    <button class="key scannable" onclick="typeKey('G')" tabindex="54" aria-label="Tecla G">G</button>
                    <button class="key scannable" onclick="typeKey('H')" tabindex="55" aria-label="Tecla H">H</button>
                    <button class="key scannable" onclick="typeKey('J')" tabindex="56" aria-label="Tecla J">J</button>
                    <button class="key scannable" onclick="typeKey('K')" tabindex="57" aria-label="Tecla K">K</button>
                    <button class="key scannable" onclick="typeKey('L')" tabindex="58" aria-label="Tecla L">L</button>
                    <button class="key scannable" onclick="typeKey('√á')" tabindex="59" aria-label="Tecla √á">√á</button>
                    
                    <button class="key scannable" onclick="typeKey('Z')" tabindex="60" aria-label="Tecla Z">Z</button>
                    <button class="key scannable" onclick="typeKey('X')" tabindex="61" aria-label="Tecla X">X</button>
                    <button class="key scannable" onclick="typeKey('C')" tabindex="62" aria-label="Tecla C">C</button>
                    <button class="key scannable" onclick="typeKey('V')" tabindex="63" aria-label="Tecla V">V</button>
                    <button class="key scannable" onclick="typeKey('B')" tabindex="64" aria-label="Tecla B">B</button>
                    <button class="key scannable" onclick="typeKey('N')" tabindex="65" aria-label="Tecla N">N</button>
                    <button class="key scannable" onclick="typeKey('M')" tabindex="66" aria-label="Tecla M">M</button>
                    <button class="key scannable" onclick="typeKey(',')" tabindex="67" aria-label="Tecla V√≠rgula">,</button>
                    <button class="key scannable" onclick="typeKey('.')" tabindex="68" aria-label="Tecla Ponto">.</button>
                    <button class="key scannable" onclick="typeKey(';')" tabindex="69" aria-label="Tecla Ponto e V√≠rgula">;</button>
                    
                    <button class="key space scannable" onclick="typeKey(' ')" tabindex="70" aria-label="Barra de Espa√ßo">ESPA√áO</button>
                    <button class="key backspace scannable" onclick="backspaceKey()" tabindex="71" aria-label="Apagar caractere">‚å´</button>
                    <button class="key enter scannable" onclick="enterKey()" tabindex="72" aria-label="Tecla Enter">ENTER</button>
                    <button class="key scannable" onclick="clearKeyboard()" tabindex="73" aria-label="Limpar texto">LIMPAR</button>
                </div>
            </div>

            <div id="web-browser" class="hidden">
                <h2>üåê Navegador Simples</h2>
                <input type="url" id="url-input" class="text-input scannable" 
                    placeholder="Digite uma URL (ex: https://google.com)" tabindex="74" aria-label="Digite o endere√ßo do site">
                <button class="action-button scannable" onclick="loadWebsite()" tabindex="75" aria-label="Carregar site">üîç Carregar Site</button>
                <div id="web-content" class="web-content">
                    <p class="web-placeholder">
                        Digite uma URL acima e clique em "Carregar Site" para navegar na web.
                    </p>
                </div>
            </div>

            <div id="accessibility-settings" class="hidden">
                <h2>‚öôÔ∏è Configura√ß√µes de Acessibilidade</h2>
                <div class="settings-section">
                    <label class="settings-label">Tamanho da Fonte:</label>
                    <button class="action-button scannable" onclick="changeFontSize('small')" tabindex="76" aria-label="Definir fonte pequena">üîç Pequena</button>
                    <button class="action-button scannable" onclick="changeFontSize('medium')" tabindex="77" aria-label="Definir fonte m√©dia">üìñ M√©dia</button>
                    <button class="action-button scannable" onclick="changeFontSize('large')" tabindex="78" aria-label="Definir fonte grande">üìò Grande</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Contraste:</label>
                    <button class="action-button scannable" onclick="toggleContrast()" tabindex="79" aria-label="Alternar alto contraste">üé® Alto Contraste</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Sons:</label>
                    <button class="action-button scannable" onclick="toggleSounds()" tabindex="80" aria-label="Alternar sons de feedback">üîä Sons de Feedback</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Varredura Autom√°tica:</label>
                    <button class="action-button scannable" onclick="toggleScanMode()" tabindex="81" id="scan-toggle" aria-label="Ativar modo de varredura autom√°tica">üîÑ Ativar Varredura</button>
                    <button class="action-button scannable" onclick="setScanSpeed(3000)" tabindex="82" aria-label="Definir velocidade lenta de varredura">üåä Lenta</button>
                    <button class="action-button scannable" onclick="setScanSpeed(2000)" tabindex="83" aria-label="Definir velocidade normal de varredura">üö∂ Normal</button>
                    <button class="action-button scannable" onclick="setScanSpeed(1000)" tabindex="84" aria-label="Definir velocidade r√°pida de varredura">üèÉ R√°pida</button>
                </div>
            </div>

            <div id="help" class="hidden">
                <h2>‚ùì Central de Ajuda</h2>
                <div class="help-content">
                    <div class="help-section">
                        <h3>üéØ Navega√ß√£o por Teclado:</h3>
                        <p><strong>TAB:</strong> Move para o pr√≥ximo elemento</p>
                        <p><strong>SHIFT + TAB:</strong> Move para o elemento anterior</p>
                        <p><strong>ENTER ou ESPA√áO:</strong> Ativa bot√µes e links</p>
                        <p><strong>ESC:</strong> Volta ao menu principal</p>
                        <p><strong>Setas:</strong> Navegar em menus e listas</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>üõ†Ô∏è Funcionalidades:</h3>
                        <p><strong>Editor de Texto:</strong> Escreva e salve documentos</p>
                        <p><strong>Calculadora:</strong> Realize c√°lculos matem√°ticos</p>
                        <p><strong>Teclado Virtual:</strong> Digite usando apenas o mouse</p>
                        <p><strong>Navegador:</strong> Acesse sites da internet</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>‚ôø Recursos de Acessibilidade:</h3>
                        <p><strong>‚Ä¢ Foco Visual:</strong> Borda amarela destaca o elemento ativo</p>
                        <p><strong>‚Ä¢ Feedback Sonoro:</strong> Sons confirmam a√ß√µes</p>
                        <p><strong>‚Ä¢ Alto Contraste:</strong> Melhora visibilidade</p>
                        <p><strong>‚Ä¢ Texto Grande:</strong> Facilita leitura</p>
                        <p><strong>‚Ä¢ Varredura Autom√°tica:</strong> Navega√ß√£o sem mouse ou teclado</p>
                    </div>

                    <div class="help-section">
                        <h3>üîÑ Modo de Varredura Autom√°tica:</h3>
                        <p><strong>Ativar:</strong> V√° em Configura√ß√µes ou use Ctrl+S</p>
                        <p><strong>Selecionar:</strong> Pressione ENTER quando o elemento desejado estiver destacado</p>
                        <p><strong>Pausar:</strong> Pressione ESPA√áO para pausar/retomar</p>
                        <p><strong>Velocidade:</strong> Configure em Configura√ß√µes (lenta, normal, r√°pida)</p>
                        <p><strong>Desativar:</strong> Pressione ESC ou v√° em Configura√ß√µes</p>
                    </div>
                </div>
            </div>

            <div id="welcome" class="welcome-content">
                <h2 class="welcome-title">Bem-vindo ao EASYFACE! üéØ</h2>
                <p class="welcome-text">
                    Esta interface foi criada especialmente para pessoas com mobilidade reduzida.<br>
                    Use o <strong>TAB</strong> para navegar e <strong>ENTER</strong> para selecionar.
                </p>
                <div class="welcome-box">
                    <h3>üöÄ Comece agora:</h3>
                    <p>Pressione <strong>TAB</strong> para ir ao menu lateral e escolha uma funcionalidade!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar" id="status-bar" aria-live="polite">
        EASYFACE carregado! Use TAB para navegar pelos elementos.
    </div>

    <div id="scan-indicator" class="scan-mode-indicator" style="display: none;">
        üîÑ MODO VARREDURA ATIVO - Pressione ENTER para selecionar
    </div>

    <div id="scan-controls" class="scan-controls" style="display: none;">
        <h4>üîÑ Controles de Varredura</h4>
        <button class="scan-control-button" onclick="pauseScanning()" id="pause-scan" aria-label="Pausar varredura">‚è∏Ô∏è Pausar</button>
        <button class="scan-control-button" onclick="toggleScanMode()" aria-label="Desativar varredura">‚èπ Desativar</button>
    </div>

    <script>
        // ===== VARI√ÅVEIS GLOBAIS =====
        let currentApp = 'welcome';
        let calcDisplay = '0';
        let calcExpression = '';
        let soundsEnabled = true;
        let highContrast = false;
        
        // Vari√°veis para varredura autom√°tica
        let scanMode = false;
        let scanInterval = null;
        let scanElements = [];
        let currentScanIndex = 0;
        let scanSpeed = 2000;
        let scanPaused = false;

        // Vari√°veis para navega√ß√£o na calculadora
        let calcFocus = { row: 0, col: 0 };
        const calcGrid = [
            [11, 12, 13, 14],   // C, ‚å´, √∑, √ó
            [15, 16, 17, 18],   // 7, 8, 9, -
            [19, 20, 21, 22],   // 4, 5, 6, +
            [23, 24, 25, 26],   // 1, 2, 3, =
            [27, 27, 28, 26]    // 0 (span 2), ., = (duplicado para mapeamento)
        ];

        // Lista de dom√≠nios seguros
        const safeDomains = [
            'google.com', 'google.com.br', 
            'wikipedia.org', 'pt.wikipedia.org',
            'gov.br', 'edu.br', 'youtube.com',
            'github.com', 'stackoverflow.com'
        ];

        // ===== FUN√á√ïES DE CONFIGURA√á√ÉO =====
        function loadUserSettings() {
            try {
                const saved = JSON.parse(localStorage.getItem('easyface-settings') || '{}');
                
                if (saved.fontSize) changeFontSize(saved.fontSize);
                if (saved.highContrast) toggleContrast();
                if (saved.soundsEnabled !== undefined) soundsEnabled = saved.soundsEnabled;
                if (saved.scanSpeed) scanSpeed = saved.scanSpeed;
                
                updateStatus('Configura√ß√µes carregadas');
            } catch (error) {
                updateStatus('Configura√ß√µes padr√£o aplicadas');
            }
        }

        function saveUserSettings() {
            try {
                const settings = {
                    fontSize: getCurrentFontSize(),
                    highContrast: highContrast,
                    soundsEnabled: soundsEnabled,
                    scanSpeed: scanSpeed
                };
                localStorage.setItem('easyface-settings', JSON.stringify(settings));
                updateStatus('Configura√ß√µes salvas automaticamente');
            } catch (error) {
                console.log('N√£o foi poss√≠vel salvar configura√ß√µes');
            }
        }

        function getCurrentFontSize() {
            const size = parseInt(document.body.style.fontSize);
            if (size <= 16) return 'small';
            if (size <= 18) return 'medium';
            return 'large';
        }

        // ===== FUN√á√ïES DE NAVEGA√á√ÉO =====
        function showApp(appId) {
            const apps = ['text-editor', 'calculator-app', 'virtual-keyboard-app', 'web-browser', 'accessibility-settings', 'help', 'welcome'];
            apps.forEach(app => {
                const element = document.getElementById(app);
                if (element) {
                    element.classList.add('hidden');
                }
            });
            
            const currentAppElement = document.getElementById(appId);
            if (currentAppElement) {
                currentAppElement.classList.remove('hidden');
            }
            currentApp = appId;
            playFeedbackSound();
        }

        function showTextEditor() { 
            showApp('text-editor'); 
        }
        
        function showCalculator() { 
            showApp('calculator-app'); 
            // Foca no bot√£o 7 quando a calculadora √© aberta
            setTimeout(() => {
                const firstNumber = document.querySelector('.calc-button[data-key="7"]');
                if (firstNumber) {
                    firstNumber.focus();
                    calcFocus = { row: 1, col: 0 }; // Posi√ß√£o do n√∫mero 7 na grade
                    document.querySelectorAll('.calc-button').forEach(btn => {
                        btn.classList.remove('navigation-focus');
                    });
                    firstNumber.classList.add('navigation-focus');
                }
            }, 100);
        }
        
        function showVirtualKeyboard() { 
            showApp('virtual-keyboard-app'); 
        }
        
        function showWebBrowser() { 
            showApp('web-browser'); 
        }
        
        function showAccessibilitySettings() { 
            showApp('accessibility-settings'); 
        }
        
        function showHelp() { 
            showApp('help'); 
        }

        // ===== FUN√á√ïES DO EDITOR DE TEXTO =====
        function saveText() {
            const text = document.getElementById('text-area').value;
            if (text.trim()) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'easyface-texto.txt';
                a.click();
                updateStatus('Texto salvo com sucesso!');
                playFeedbackSound();
            } else {
                updateStatus('Nenhum texto para salvar.');
            }
        }

        function clearText() {
            document.getElementById('text-area').value = '';
            updateStatus('Texto limpo.');
            playFeedbackSound();
        }

        function speakText() {
            const text = document.getElementById('text-area').value;
            if (text.trim() && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                speechSynthesis.speak(utterance);
                updateStatus('Lendo texto...');
            } else {
                updateStatus('Nenhum texto para ler ou recurso n√£o dispon√≠vel.');
            }
        }

        // ===== FUN√á√ïES DA CALCULADORA =====
        function addToCalc(value) {
            if (calcDisplay === '0' && !isNaN(value)) {
                calcDisplay = value;
            } else {
                calcDisplay += value;
            }
            calcExpression += value;
            document.getElementById('calc-display').textContent = calcDisplay;
            playFeedbackSound();
        }

        function calculateResult() {
            if (calcExpression.trim() === '') {
                calcDisplay = '0';
                document.getElementById('calc-display').textContent = calcDisplay;
                return;
            }
            
            try {
                const expressionToEval = calcExpression
                    .replace(/√ó/g, '*')
                    .replace(/√∑/g, '/')
                    .replace(/‚àí/g, '-');
                
                const result = eval(expressionToEval);
                calcDisplay = result.toString();
                calcExpression = result.toString();
                document.getElementById('calc-display').textContent = calcDisplay;
            } catch (error) {
                calcDisplay = 'Erro';
                calcExpression = '';
                document.getElementById('calc-display').textContent = calcDisplay;
            }
        }

        function clearCalc() {
            calcDisplay = '0';
            calcExpression = '';
            document.getElementById('calc-display').textContent = calcDisplay;
            updateStatus('Calculadora limpa');
            playFeedbackSound();
        }

        function deleteLast() {
            if (calcDisplay.length > 1) {
                calcDisplay = calcDisplay.slice(0, -1);
                calcExpression = calcExpression.slice(0, -1);
            } else {
                calcDisplay = '0';
                calcExpression = '';
            }
            document.getElementById('calc-display').textContent = calcDisplay;
            playFeedbackSound();
        }

        // ===== SISTEMA DE NAVEGA√á√ÉO POR SETAS =====
        function moveCalcFocus(rowDelta, colDelta) {
            const newRow = Math.max(0, Math.min(calcFocus.row + rowDelta, calcGrid.length - 1));
            let newCol = Math.max(0, Math.min(calcFocus.col + colDelta, calcGrid[newRow].length - 1));
            
            // Ajuste especial para o bot√£o 0 que ocupa duas colunas
            if (newRow === 4 && newCol === 1) {
                newCol = 0;
            }
            
            // Encontra o elemento a ser focado
            const tabIndex = calcGrid[newRow][newCol];
            const element = document.querySelector(`.calc-button[tabindex="${tabIndex}"]`);
            
            if (element) {
                element.focus();
                calcFocus = { row: newRow, col: newCol };
                
                // Destacar visualmente o bot√£o com foco de navega√ß√£o
                document.querySelectorAll('.calc-button').forEach(btn => {
                    btn.classList.remove('navigation-focus');
                });
                element.classList.add('navigation-focus');
            }
        }

        // ===== FUN√á√ïES DO TECLADO VIRTUAL =====
        function typeKey(key) {
            const input = document.getElementById('keyboard-input');
            input.value += key;
            input.focus();
            playFeedbackSound();
        }

        function backspaceKey() {
            const input = document.getElementById('keyboard-input');
            input.value = input.value.slice(0, -1);
            playFeedbackSound();
        }

        function enterKey() {
            const input = document.getElementById('keyboard-input');
            input.value += '\n';
            playFeedbackSound();
        }

        function clearKeyboard() {
            document.getElementById('keyboard-input').value = '';
            updateStatus('Texto limpo');
            playFeedbackSound();
        }

        // ===== FUN√á√ïES DO NAVEGADOR =====
        function isUrlSafe(url) {
            try {
                const urlObj = new URL(url.startsWith('http') ? url : 'https://' + url);
                const hostname = urlObj.hostname.toLowerCase();
                
                return safeDomains.some(domain => 
                    hostname === domain || hostname.endsWith('.' + domain)
                );
            } catch (error) {
                return false;
            }
        }

        function loadWebsite() {
            const url = document.getElementById('url-input').value.trim();
            const webContent = document.getElementById('web-content');
            
            if (!url) {
                updateStatus('Por favor, digite uma URL v√°lida.');
                return;
            }
            
            if (!isUrlSafe(url)) {
                webContent.innerHTML = `
                    <div class="alert-warning">
                        <strong>‚ö†Ô∏è URL Bloqueada por Seguran√ßa</strong><br>
                        Por quest√µes de seguran√ßa, apenas sites confi√°veis s√£o permitidos.<br><br>
                        <strong>Sites seguros permitidos:</strong><br>
                        ‚Ä¢ Google (google.com)<br>
                        ‚Ä¢ Wikipedia (wikipedia.org)<br>
                        ‚Ä¢ Sites governamentais (.gov.br)<br>
                        ‚Ä¢ Sites educacionais (.edu.br)<br>
                        ‚Ä¢ GitHub, Stack Overflow, YouTube<br><br>
                        Tente uma URL de um destes dom√≠nios.
                    </div>
                `;
                updateStatus('URL bloqueada por seguran√ßa');
                playErrorSound();
                return;
            }
            
            const finalUrl = url.startsWith('http') ? url : 'https://' + url;
            webContent.innerHTML = `
                <iframe src="${finalUrl}" class="browser-iframe" 
                        title="Navegador web incorporado"
                        aria-label="Conte√∫do do site carregado">
                    Carregando site...
                </iframe>
            `;
            updateStatus('Site seguro carregado!');
            playFeedbackSound();
        }

        // ===== FUN√á√ïES DE ACESSIBILIDADE =====
        function changeFontSize(size) {
            const body = document.body;
            body.classList.remove('font-small', 'font-medium', 'font-large');
            
            if (size === 'small') {
                body.style.fontSize = '16px';
                updateStatus('Fonte pequena aplicada');
            } else if (size === 'medium') {
                body.style.fontSize = '18px';
                updateStatus('Fonte m√©dia aplicada');
            } else if (size === 'large') {
                body.style.fontSize = '22px';
                updateStatus('Fonte grande aplicada');
            }
            
            saveUserSettings();
            playFeedbackSound();
        }

        function toggleContrast() {
            highContrast = !highContrast;
            if (highContrast) {
                document.body.style.filter = 'contrast(150%) brightness(110%)';
                updateStatus('Alto contraste ativado');
            } else {
                document.body.style.filter = 'none';
                updateStatus('Alto contraste desativado');
            }
            
            saveUserSettings();
            playFeedbackSound();
        }

        function toggleSounds() {
            soundsEnabled = !soundsEnabled;
            updateStatus(soundsEnabled ? 'Sons ativados' : 'Sons desativados');
            
            saveUserSettings();
            if (soundsEnabled) playFeedbackSound();
        }

        // ===== FUN√á√ïES DE VARREDURA AUTOM√ÅTICA =====
        function toggleScanMode() {
            scanMode = !scanMode;
            const button = document.getElementById('scan-toggle');
            const indicator = document.getElementById('scan-indicator');
            const controls = document.getElementById('scan-controls');
            
            if (scanMode) {
                startScanning();
                button.textContent = '‚èπÔ∏è Parar Varredura';
                button.setAttribute('aria-label', 'Parar modo de varredura autom√°tica');
                indicator.style.display = 'block';
                controls.style.display = 'block';
                updateStatus('Modo de varredura ativado - Use ENTER para selecionar');
            } else {
                stopScanning();
                button.textContent = 'üîÑ Ativar Varredura';
                button.setAttribute('aria-label', 'Ativar modo de varredura autom√°tica');
                indicator.style.display = 'none';
                controls.style.display = 'none';
                updateStatus('Modo de varredura desativado');
            }
            
            saveUserSettings();
        }

        function startScanning() {
            scanElements = document.querySelectorAll('.scannable:not([disabled])');
            currentScanIndex = 0;
            scanPaused = false;
            
            if (scanElements.length > 0) {
                scanInterval = setInterval(nextScanElement, scanSpeed);
                highlightCurrentElement();
            }
        }

        function stopScanning() {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }
            
            scanElements.forEach(el => el.classList.remove('scan-active'));
            scanElements = [];
            currentScanIndex = 0;
        }

        function nextScanElement() {
            if (scanPaused) return;
            
            if (scanElements[currentScanIndex]) {
                scanElements[currentScanIndex].classList.remove('scan-active');
            }
            
            currentScanIndex = (currentScanIndex + 1) % scanElements.length;
            highlightCurrentElement();
        }

        function highlightCurrentElement() {
            if (scanElements[currentScanIndex]) {
                const element = scanElements[currentScanIndex];
                element.classList.add('scan-active');
                
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                if (soundsEnabled) {
                    playDifferentSound(800);
                }
                
                const label = element.getAttribute('aria-label') || element.textContent;
                updateStatus(`Selecionando: ${label.trim()}`);
            }
        }

        function selectCurrentScanElement() {
            if (scanElements[currentScanIndex] && scanMode) {
                const element = scanElements[currentScanIndex];
                element.classList.remove('scan-active');
                element.click();
                playFeedbackSound();
                return true;
            }
            return false;
        }

        function pauseScanning() {
            scanPaused = !scanPaused;
            const button = document.getElementById('pause-scan');
            
            if (scanPaused) {
                button.textContent = '‚ñ∂Ô∏è Continuar';
                updateStatus('Varredura pausada');
            } else {
                button.textContent = '‚è∏Ô∏è Pausar';
                updateStatus('Varredura retomada');
            }
        }

        function setScanSpeed(speed) {
            scanSpeed = speed;
            updateStatus(`Velocidade definida: ${speed/1000} segundos`);
            
            if (scanMode) {
                stopScanning();
                startScanning();
            }
            
            saveUserSettings();
        }

        // ===== FUN√á√ïES DE SOM =====
        function playFeedbackSound() {
            playDifferentSound(800, 0.1);
        }

        function playErrorSound() {
            playDifferentSound(300, 0.2);
        }

        function playDifferentSound(frequency, duration = 0.1) {
            if (!soundsEnabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Erro ao reproduzir som');
            }
        }

        // ===== FUN√á√ïES DE STATUS =====
        function updateStatus(message) {
            const statusBar = document.getElementById('status-bar');
            statusBar.textContent = message;
            statusBar.setAttribute('aria-live', 'polite');
            
            setTimeout(() => {
                if (!scanMode) {
                    statusBar.textContent = 'EASYFACE ativo - Use TAB para navegar';
                } else {
                    statusBar.textContent = 'EASYFACE - Modo varredura ativo - ENTER para selecionar';
                }
            }, 3000);
        }

        // ===== FUN√á√ïES DE RECONHECIMENTO DE VOZ =====
        function checkVoiceRecognitionSupport() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                const voiceWarning = document.createElement('div');
                voiceWarning.className = 'alert-warning';
                voiceWarning.innerHTML = `
                    <strong>‚ö†Ô∏è Comando de Voz Indispon√≠vel</strong><br>
                    Seu navegador n√£o suporta reconhecimento de voz. 
                    Recomendamos usar Google Chrome para ter acesso a todos os recursos.
                `;
                
                const settingsDiv = document.getElementById('accessibility-settings');
                if (settingsDiv) {
                    settingsDiv.appendChild(voiceWarning);
                }
                return false;
            }
            return true;
        }

        function setupVoiceRecognition() {
            if (!checkVoiceRecognitionSupport()) return;

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            function startVoiceCommand() {
                try {
                    recognition.start();
                    updateStatus('Escutando comando de voz... Diga: "editor", "calculadora", etc.');
                } catch (error) {
                    updateStatus('Erro ao iniciar reconhecimento de voz');
                    playErrorSound();
                }
            }
            
            recognition.onresult = function(event) {
                const command = event.results[0][0].transcript.toLowerCase().trim();
                updateStatus(`Comando reconhecido: ${command}`);
                
                if (command.includes('editor') || command.includes('texto')) {
                    showTextEditor();
                } else if (command.includes('calculadora') || command.includes('calcular')) {
                    showCalculator();
                } else if (command.includes('teclado')) {
                    showVirtualKeyboard();
                } else if (command.includes('navegador') || command.includes('internet')) {
                    showWebBrowser();
                } else if (command.includes('configura√ß√µes') || command.includes('configurar')) {
                    showAccessibilitySettings();
                } else if (command.includes('ajuda') || command.includes('socorro')) {
                    showHelp();
                } else if (command.includes('varredura') || command.includes('escanear')) {
                    toggleScanMode();
                } else {
                    updateStatus('Comando n√£o reconhecido. Tente: "editor", "calculadora", "configura√ß√µes"...');
                    playErrorSound();
                }
            };
            
            recognition.onerror = function(event) {
                updateStatus('Erro no reconhecimento de voz: ' + event.error);
                playErrorSound();
            };
            
            // Adicionar bot√£o de comando de voz
            const voiceButton = document.createElement('button');
            voiceButton.className = 'menu-button scannable';
            voiceButton.innerHTML = 'üé§ Comando de Voz';
            voiceButton.onclick = startVoiceCommand;
            voiceButton.tabIndex = 90;
            voiceButton.setAttribute('aria-label', 'Ativar comando de voz - Diga o nome da funcionalidade desejada');
            document.querySelector('.sidebar').appendChild(voiceButton);
        }

        // ===== INICIALIZA√á√ÉO DA CALCULADORA =====
        function initCalculator() {
            const calculatorApp = document.getElementById('calculator-app');
            if (!calculatorApp) return;

            // Atualiza calcFocus quando um bot√£o ganha foco
            document.querySelectorAll('.calc-button').forEach(button => {
                button.addEventListener('focus', function () {
                    for (let row = 0; row < calcGrid.length; row++) {
                        for (let col = 0; col < calcGrid[row].length; col++) {
                            if (calcGrid[row][col] === parseInt(this.getAttribute('tabindex'))) {
                                calcFocus = { row, col };
                                document.querySelectorAll('.calc-button').forEach(btn => btn.classList.remove('navigation-focus'));
                                this.classList.add('navigation-focus');
                                return;
                            }
                        }
                    }
                });
            });
        }

        // ===== EVENT LISTENERS GERAL (√öNICO E CONSOLIDADO) =====
        document.addEventListener('keydown', function(e) {
            const focused = document.activeElement;
            const isCalcButtonFocused = focused && focused.classList.contains('calc-button');
            
            // L√≥gica de navega√ß√£o da calculadora com setas e outras teclas
            if (currentApp === 'calculator-app' && isCalcButtonFocused) {
                const key = e.key;
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(key)) {
                    e.preventDefault();
                    if (key === 'ArrowRight') moveCalcFocus(0, 1);
                    else if (key === 'ArrowLeft') moveCalcFocus(0, -1);
                    else if (key === 'ArrowDown') moveCalcFocus(1, 0);
                    else if (key === 'ArrowUp') moveCalcFocus(-1, 0);
                    return;
                }
                
                if ('0123456789.+-*/'.includes(key)) {
                    e.preventDefault();
                    addToCalc(key);
                    return;
                } else if (key === 'Enter') {
                    e.preventDefault();
                    if (focused && focused.classList.contains('calc-button')) {
                        focused.click();
                    } else {
                        calculateResult();
                    }
                    return;
                } else if (key === 'Escape') {
                    e.preventDefault();
                    clearCalc();
                    return;
                } else if (key === 'Backspace') {
                    e.preventDefault();
                    deleteLast();
                    return;
                }
            }

            // L√≥gica de varredura autom√°tica (ap√≥s a calculadora)
            if (scanMode && e.key === 'Enter') {
                e.preventDefault();
                if (selectCurrentScanElement()) {
                    return;
                }
            }
            
            // ESC volta ao menu principal
            if (e.key === 'Escape') {
                if (scanMode) {
                    toggleScanMode();
                } else {
                    showApp('welcome');
                    const firstButton = document.querySelector('.menu-button');
                    if (firstButton) firstButton.focus();
                }
                e.preventDefault();
                return;
            }
            
            // Barra de espa√ßo para pausar varredura
            if (scanMode && e.key === ' ') {
                e.preventDefault();
                pauseScanning();
                return;
            }
            
            // Atalhos de teclado para apps (Ctrl + n√∫mero)
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTextEditor();
                        break;
                    case '2':
                        e.preventDefault();
                        showCalculator();
                        break;
                    case '3':
                        e.preventDefault();
                        showVirtualKeyboard();
                        break;
                    case '4':
                        e.preventDefault();
                        showWebBrowser();
                        break;
                    case '5':
                        e.preventDefault();
                        showAccessibilitySettings();
                        break;
                    case '6':
                        e.preventDefault();
                        showHelp();
                        break;
                    case 's':
                        e.preventDefault();
                        toggleScanMode();
                        break;
                }
            }
        });

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar a calculadora
            initCalculator();
        });

        window.addEventListener('load', function() {
            // Verificar e configurar reconhecimento de voz
            setupVoiceRecognition();
            
            // Carregar configura√ß√µes salvas
            loadUserSettings();
            
            updateStatus('EASYFACE carregado e pronto para uso!');
            
            // Foco inicial no primeiro bot√£o do menu ap√≥s um delay
            setTimeout(() => {
                if (!scanMode) {
                    const firstButton = document.querySelector('.menu-button');
                    if (firstButton) firstButton.focus();
                }
            }, 1000);
        });
    </script>
</body>
</html>