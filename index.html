<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EASYFACE - Interface Acessível</title>
    <link rel="stylesheet" href="estilos.css">
</head>
<body>
    <a href="#main-content" class="skip-link">Pular para o conteúdo principal</a>
    
    <div class="header">
        <h1>💻 EASYFACE</h1>
        <div class="instructions">
            📝 Use TAB para navegar | ENTER ou ESPAÇO para ativar | ESC para voltar | Setas para mover
        </div>
    </div>

    <div class="main-container">
        <div class="sidebar">
            <h2>🎯 Menu Principal</h2>
            <button class="menu-button scannable" onclick="showTextEditor()" tabindex="1" aria-label="Abrir Editor de Texto">
                📝 Editor de Texto
            </button>
            <button class="menu-button scannable" onclick="showFileManager()" tabindex="2" aria-label="Abrir Gerenciador de Arquivos">
                📁 Gerenciador de Arquivos
            </button>
            <button class="menu-button scannable" onclick="showCalculator()" tabindex="3" aria-label="Abrir Calculadora">
                🔢 Calculadora
            </button>
            <button class="menu-button scannable" onclick="showVirtualKeyboard()" tabindex="4" aria-label="Abrir Teclado Virtual">
                ⌨️ Teclado Virtual
            </button>
            <button class="menu-button scannable" onclick="showSiteLauncher()" tabindex="5" aria-label="Abrir Launcher de Sites">
                🌐 Sites Seguros
            </button>
            <button class="menu-button scannable" onclick="showMediaPlayer()" tabindex="6" aria-label="Abrir Reprodutor de Mídia">
                🎵 Reprodutor de Mídia
            </button>
            <button class="menu-button scannable" onclick="showPdfReader()" tabindex="7" aria-label="Abrir Leitor de PDF">
                📄 Leitor de PDF
            </button>
            <button class="menu-button scannable" onclick="showCommunicationAid()" tabindex="8" aria-label="Abrir Ferramenta de Comunicação">
                💬 Comunicação Alternativa
            </button>
            <button class="menu-button scannable" onclick="showEmailIntegration()" tabindex="9" aria-label="Abrir Integração de E-mail">
                ✉️ Integração de E-mail
            </button>
            <button class="menu-button scannable" onclick="showAccessibilitySettings()" tabindex="10" aria-label="Abrir Configurações de Acessibilidade">
                ⚙️ Configurações
            </button>
            <button class="menu-button scannable" onclick="showHelp()" tabindex="11" aria-label="Abrir Ajuda">
                ❓ Ajuda
            </button>
        </div>

        <div class="content-area" id="main-content" tabindex="-1">
            <div id="text-editor" class="app-container hidden">
                <h2>📝 Editor de Texto</h2>
                <textarea id="text-area" class="text-input scannable" rows="10" 
                    placeholder="Digite seu texto aqui... Use TAB para navegar pelos botões abaixo."
                    tabindex="12" aria-label="Área de edição de texto"></textarea>
                <button class="action-button scannable" onclick="saveText()" tabindex="13" aria-label="Salvar texto">💾 Salvar Texto</button>
                <button class="action-button scannable" onclick="clearText()" tabindex="14" aria-label="Limpar texto">🗑️ Limpar</button>
                <button class="action-button scannable" onclick="speakText()" tabindex="15" aria-label="Ler texto em voz alta">🔊 Ler Texto</button>
            </div>

            <div id="file-manager" class="app-container hidden">
                <h2>📁 Gerenciador de Arquivos</h2>
                <div class="file-actions">
                    <input type="file" id="file-input" class="hidden" accept=".txt">
                    <button class="action-button scannable" onclick="document.getElementById('file-input').click()" tabindex="16" aria-label="Abrir arquivo de texto">📂 Abrir Arquivo</button>
                    <button class="action-button scannable" onclick="saveTextFile()" tabindex="17" aria-label="Salvar arquivo de texto">💾 Salvar Como</button>
                </div>
                <div id="file-content" class="file-content">
                    <textarea id="file-text-area" class="text-input scannable" rows="10" 
                        placeholder="Conteúdo do arquivo aparecerá aqui..."
                        tabindex="18" aria-label="Conteúdo do arquivo"></textarea>
                </div>
                <div id="file-info" class="file-info" aria-live="polite"></div>
            </div>

            <div id="calculator-app" class="app-container hidden">
                <h2>🔢 Calculadora</h2>
                <div class="calc-display" id="calc-display" aria-live="polite">0</div>
                <div class="calculator" id="calculator-grid">
                    <button class="calc-button scannable" onclick="clearCalc()" tabindex="11" data-key="Escape">C</button>
                    <button class="calc-button scannable" onclick="deleteLast()" tabindex="12" data-key="Backspace">⌫</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('/')" tabindex="13" data-key="/">÷</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('*')" tabindex="14" data-key="*">×</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('7')" tabindex="15" data-key="7">7</button>
                    <button class="calc-button scannable" onclick="addToCalc('8')" tabindex="16" data-key="8">8</button>
                    <button class="calc-button scannable" onclick="addToCalc('9')" tabindex="17" data-key="9">9</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('-')" tabindex="18" data-key="-">-</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('4')" tabindex="19" data-key="4">4</button>
                    <button class="calc-button scannable" onclick="addToCalc('5')" tabindex="20" data-key="5">5</button>
                    <button class="calc-button scannable" onclick="addToCalc('6')" tabindex="21" data-key="6">6</button>
                    <button class="calc-button operator scannable" onclick="addToCalc('+')" tabindex="22" data-key="+">+</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('1')" tabindex="23" data-key="1">1</button>
                    <button class="calc-button scannable" onclick="addToCalc('2')" tabindex="24" data-key="2">2</button>
                    <button class="calc-button scannable" onclick="addToCalc('3')" tabindex="25" data-key="3">3</button>
                    <button class="calc-button equals scannable" onclick="calculateResult()" tabindex="26" data-key="Enter">=</button>
                    
                    <button class="calc-button scannable" onclick="addToCalc('0')" tabindex="27" style="grid-column: span 2;" data-key="0">0</button>
                    <button class="calc-button scannable" onclick="addToCalc('.')" tabindex="28" data-key=".">.</button>
                </div>
            </div>

            <div id="virtual-keyboard-app" class="app-container hidden">
                <h2>⌨️ Teclado Virtual</h2>
                <input type="text" id="keyboard-input" class="text-input scannable" 
                    placeholder="O texto digitado aparecerá aqui..." tabindex="29" aria-label="Entrada do teclado virtual">
                <div class="virtual-keyboard">
                    <button class="key scannable" onclick="typeKey('1')" tabindex="30" aria-label="Tecla 1">1</button>
                    <button class="key scannable" onclick="typeKey('2')" tabindex="31" aria-label="Tecla 2">2</button>
                    <button class="key scannable" onclick="typeKey('3')" tabindex="32" aria-label="Tecla 3">3</button>
                    <button class="key scannable" onclick="typeKey('4')" tabindex="33" aria-label="Tecla 4">4</button>
                    <button class="key scannable" onclick="typeKey('5')" tabindex="34" aria-label="Tecla 5">5</button>
                    <button class="key scannable" onclick="typeKey('6')" tabindex="35" aria-label="Tecla 6">6</button>
                    <button class="key scannable" onclick="typeKey('7')" tabindex="36" aria-label="Tecla 7">7</button>
                    <button class="key scannable" onclick="typeKey('8')" tabindex="37" aria-label="Tecla 8">8</button>
                    <button class="key scannable" onclick="typeKey('9')" tabindex="38" aria-label="Tecla 9">9</button>
                    <button class="key scannable" onclick="typeKey('0')" tabindex="39" aria-label="Tecla 0">0</button>
                    
                    <button class="key scannable" onclick="typeKey('Q')" tabindex="40" aria-label="Tecla Q">Q</button>
                    <button class="key scannable" onclick="typeKey('W')" tabindex="41" aria-label="Tecla W">W</button>
                    <button class="key scannable" onclick="typeKey('E')" tabindex="42" aria-label="Tecla E">E</button>
                    <button class="key scannable" onclick="typeKey('R')" tabindex="43" aria-label="Tecla R">R</button>
                    <button class="key scannable" onclick="typeKey('T')" tabindex="44" aria-label="Tecla T">T</button>
                    <button class="key scannable" onclick="typeKey('Y')" tabindex="45" aria-label="Tecla Y">Y</button>
                    <button class="key scannable" onclick="typeKey('U')" tabindex="46" aria-label="Tecla U">U</button>
                    <button class="key scannable" onclick="typeKey('I')" tabindex="47" aria-label="Tecla I">I</button>
                    <button class="key scannable" onclick="typeKey('O')" tabindex="48" aria-label="Tecla O">O</button>
                    <button class="key scannable" onclick="typeKey('P')" tabindex="49" aria-label="Tecla P">P</button>
                    
                    <button class="key scannable" onclick="typeKey('A')" tabindex="50" aria-label="Tecla A">A</button>
                    <button class="key scannable" onclick="typeKey('S')" tabindex="51" aria-label="Tecla S">S</button>
                    <button class="key scannable" onclick="typeKey('D')" tabindex="52" aria-label="Tecla D">D</button>
                    <button class="key scannable" onclick="typeKey('F')" tabindex="53" aria-label="Tecla F">F</button>
                    <button class="key scannable" onclick="typeKey('G')" tabindex="54" aria-label="Tecla G">G</button>
                    <button class="key scannable" onclick="typeKey('H')" tabindex="55" aria-label="Tecla H">H</button>
                    <button class="key scannable" onclick="typeKey('J')" tabindex="56" aria-label="Tecla J">J</button>
                    <button class="key scannable" onclick="typeKey('K')" tabindex="57" aria-label="Tecla K">K</button>
                    <button class="key scannable" onclick="typeKey('L')" tabindex="58" aria-label="Tecla L">L</button>
                    <button class="key scannable" onclick="typeKey('Ç')" tabindex="59" aria-label="Tecla Ç">Ç</button>
                    
                    <button class="key scannable" onclick="typeKey('Z')" tabindex="60" aria-label="Tecla Z">Z</button>
                    <button class="key scannable" onclick="typeKey('X')" tabindex="61" aria-label="Tecla X">X</button>
                    <button class="key scannable" onclick="typeKey('C')" tabindex="62" aria-label="Tecla C">C</button>
                    <button class="key scannable" onclick="typeKey('V')" tabindex="63" aria-label="Tecla V">V</button>
                    <button class="key scannable" onclick="typeKey('B')" tabindex="64" aria-label="Tecla B">B</button>
                    <button class="key scannable" onclick="typeKey('N')" tabindex="65" aria-label="Tecla N">N</button>
                    <button class="key scannable" onclick="typeKey('M')" tabindex="66" aria-label="Tecla M">M</button>
                    <button class="key scannable" onclick="typeKey(',')" tabindex="67" aria-label="Tecla Vírgula">,</button>
                    <button class="key scannable" onclick="typeKey('.')" tabindex="68" aria-label="Tecla Ponto">.</button>
                    <button class="key scannable" onclick="typeKey(';')" tabindex="69" aria-label="Tecla Ponto e Vírgula">;</button>
                    
                    <button class="key space scannable" onclick="typeKey(' ')" tabindex="70" aria-label="Barra de Espaço">ESPAÇO</button>
                    <button class="key backspace scannable" onclick="backspaceKey()" tabindex="71" aria-label="Apagar caractere">⌫</button>
                    <button class="key enter scannable" onclick="enterKey()" tabindex="72" aria-label="Tecla Enter">ENTER</button>
                    <button class="key scannable" onclick="clearKeyboard()" tabindex="73" aria-label="Limpar texto">LIMPAR</button>
                </div>
            </div>

            <div id="site-launcher" class="app-container hidden">
                <h2>🌐 Sites Seguros</h2>
                <p class="launcher-description">Clique em um dos sites abaixo para abrir em uma nova janela de forma segura:</p>
    
    <div class="sites-grid">
        <button class="site-button scannable" onclick="launchSite('https://www.google.com')" tabindex="50" aria-label="Abrir Google">
            <span class="site-icon">🔍</span>
            <span class="site-name">Google</span>
        </button>
        
        <button class="site-button scannable" onclick="launchSite('https://www.wikipedia.org')" tabindex="51" aria-label="Abrir Wikipedia">
            <span class="site-icon">📚</span>
            <span class="site-name">Wikipedia</span>
        </button>
        
        <button class="site-button scannable" onclick="launchSite('https://www.youtube.com')" tabindex="52" aria-label="Abrir YouTube">
            <span class="site-icon">▶️</span>
            <span class="site-name">YouTube</span>
        </button>
        
        <button class="site-button scannable" onclick="launchSite('https://web.whatsapp.com')" tabindex="53" aria-label="Abrir WhatsApp Web">
            <span class="site-icon">💬</span>
            <span class="site-name">WhatsApp Web</span>
        </button>
        
        <button class="site-button scannable" onclick="launchSite('https://mail.google.com')" tabindex="54" aria-label="Abrir Gmail">
            <span class="site-icon">📧</span>
            <span class="site-name">Gmail</span>
        </button>
    </div>
    
    <div class="custom-site">
        <h3>Outro site</h3>
        <input type="text" id="custom-site-url" class="text-input scannable" 
            placeholder="Digite uma URL (ex: exemplo.com)" tabindex="56" aria-label="URL personalizada">
        <button class="action-button scannable" onclick="launchCustomSite()" tabindex="57" aria-label="Abrir site personalizado">
            🔗 Abrir Site
        </button>
    </div>
            </div>

            <div id="media-player" class="app-container hidden">
                <h2>🎵 Reprodutor de Mídia</h2>
                <div class="media-controls">
                    <input type="file" id="media-input" class="hidden" accept="audio/*,video/*">
                    <button class="action-button scannable" onclick="document.getElementById('media-input').click()" tabindex="19" aria-label="Selecionar arquivo de mídia">📁 Selecionar Mídia</button>
                </div>
                <div class="media-container">
                    <audio id="audio-player" controls class="hidden" aria-label="Reprodutor de áudio"></audio>
                    <video id="video-player" controls class="hidden" aria-label="Reprodutor de vídeo"></video>
                </div>
                <div id="media-info" class="media-info" aria-live="polite"></div>
            </div>

            <div id="pdf-reader" class="app-container hidden">
                <h2>📄 Leitor de PDF</h2>
                <div class="pdf-controls">
                    <input type="file" id="pdf-input" class="hidden" accept=".pdf">
                    <button class="action-button scannable" onclick="document.getElementById('pdf-input').click()" tabindex="20" aria-label="Abrir arquivo PDF">📂 Abrir PDF</button>
                    <button class="action-button scannable" onclick="prevPage()" tabindex="21" aria-label="Página anterior">⬅️ Anterior</button>
                    <button class="action-button scannable" onclick="nextPage()" tabindex="22" aria-label="Próxima página">➡️ Próxima</button>
                    <button class="action-button scannable" onclick="zoomIn()" tabindex="23" aria-label="Aumentar zoom">➕ Zoom +</button>
                    <button class="action-button scannable" onclick="zoomOut()" tabindex="24" aria-label="Diminuir zoom">➖ Zoom -</button>
                </div>
                <div id="pdf-container" class="pdf-container">
                    <canvas id="pdf-canvas" aria-label="Visualização do documento PDF"></canvas>
                </div>
                <div id="pdf-info" class="pdf-info" aria-live="polite">Página 0 de 0</div>
            </div>

            <div id="communication-aid" class="app-container hidden">
                <h2>💬 Comunicação Alternativa</h2>
                <div class="communication-output">
                    <div id="communication-display" class="communication-display" aria-live="polite">
                        Sua mensagem aparecerá aqui...
                    </div>
                    <button class="action-button scannable" onclick="speakCommunication()" tabindex="25" aria-label="Falar mensagem">🔊 Falar</button>
                    <button class="action-button scannable" onclick="clearCommunication()" tabindex="26" aria-label="Limpar mensagem">🗑️ Limpar</button>
                </div>
                <div class="communication-categories">
                    <button class="category-button scannable" onclick="showPhrases('saudacoes')" tabindex="27" aria-label="Saudações">👋 Saudações</button>
                    <button class="category-button scannable" onclick="showPhrases('necessidades')" tabindex="28" aria-label="Necessidades">🍽️ Necessidades</button>
                    <button class="category-button scannable" onclick="showPhrases('sentimentos')" tabindex="29" aria-label="Sentimentos">❤️ Sentimentos</button>
                    <button class="category-button scannable" onclick="showPhrases('emergencia')" tabindex="30" aria-label="Emergência">🚨 Emergência</button>
                </div>
                <div id="phrases-container" class="phrases-container">
                </div>
            </div>

            <div id="email-integration" class="app-container hidden">
                <h2>✉️ Integração de E-mail</h2>
                <div class="email-options">
                    <button class="action-button scannable" onclick="openGmail()" tabindex="31" aria-label="Abrir Gmail">📧 Abrir Gmail</button>
                    <button class="action-button scannable" onclick="openWhatsApp()" tabindex="32" aria-label="Abrir WhatsApp">💬 Abrir WhatsApp</button>
                </div>
                <div class="email-compose">
                    <h3>Enviar Mensagem Rápida</h3>
                    <input type="email" id="email-to" class="text-input scannable" placeholder="Para (e-mail)" tabindex="33" aria-label="Destinatário do e-mail">
                    <input type="text" id="email-subject" class="text-input scannable" placeholder="Assunto" tabindex="34" aria-label="Assunto do e-mail">
                    <textarea id="email-body" class="text-input scannable" rows="5" placeholder="Mensagem..." tabindex="35" aria-label="Corpo do e-mail"></textarea>
                    <button class="action-button scannable" onclick="sendEmail()" tabindex="36" aria-label="Enviar e-mail">📤 Enviar</button>
                </div>
            </div>

            <div id="accessibility-settings" class="app-container hidden">
                <h2>⚙️ Configurações de Acessibilidade</h2>
                <div class="settings-section">
                    <label class="settings-label">Tamanho da Fonte:</label>
                    <button class="action-button scannable" onclick="changeFontSize('small')" tabindex="37" aria-label="Definir fonte pequena">🔍 Pequena</button>
                    <button class="action-button scannable" onclick="changeFontSize('medium')" tabindex="38" aria-label="Definir fonte média">📖 Média</button>
                    <button class="action-button scannable" onclick="changeFontSize('large')" tabindex="39" aria-label="Definir fonte grande">📘 Grande</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Contraste:</label>
                    <button class="action-button scannable" onclick="toggleContrast()" tabindex="40" aria-label="Alternar alto contraste">🎨 Alto Contraste</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Sons:</label>
                    <button class="action-button scannable" onclick="toggleSounds()" tabindex="41" aria-label="Alternar sons de feedback">🔊 Sons de Feedback</button>
                </div>
                <div class="settings-section">
                    <label class="settings-label">Varredura Automática:</label>
                    <button class="action-button scannable" onclick="toggleScanMode()" tabindex="42" id="scan-toggle" aria-label="Ativar modo de varredura automática">🔄 Ativar Varredura</button>
                    <button class="action-button scannable" onclick="setScanSpeed(3000)" tabindex="43" aria-label="Definir velocidade lenta de varredura">🌊 Lenta</button>
                    <button class="action-button scannable" onclick="setScanSpeed(2000)" tabindex="44" aria-label="Definir velocidade normal de varredura">🚶 Normal</button>
                    <button class="action-button scannable" onclick="setScanSpeed(1000)" tabindex="45" aria-label="Definir velocidade rápida de varredura">🏃 Rápida</button>
                </div>
                <div class="settings-section">
                    <h3>⌨️ Personalizar Atalhos</h3>
                    <div class="shortcut-settings">
                        <div class="shortcut-item">
                            <label>Editor de Texto:</label>
                            <input type="text" class="shortcut-input" id="shortcut-text" maxlength="2" value="1" aria-label="Atalho para Editor de Texto">
                        </div>
                        <div class="shortcut-item">
                            <label>Gerenciador de Arquivos:</label>
                            <input type="text" class="shortcut-input" id="shortcut-file" maxlength="2" value="2" aria-label="Atalho para Gerenciador de Arquivos">
                        </div>
                        <div class="shortcut-item">
                            <label>Calculadora:</label>
                            <input type="text" class="shortcut-input" id="shortcut-calc" maxlength="2" value="3" aria-label="Atalho para Calculadora">
                        </div>
                    </div>
                    <button class="action-button scannable" onclick="saveShortcuts()" tabindex="46" aria-label="Salvar atalhos personalizados">💾 Salvar Atalhos</button>
                </div>
            </div>

            <div id="help" class="app-container hidden">
                <h2>❓ Central de Ajuda</h2>
                <div class="help-content">
                    <div class="help-section">
                        <h3>🎯 Navegação por Teclado:</h3>
                        <p><strong>TAB:</strong> Move para o próximo elemento</p>
                        <p><strong>SHIFT + TAB:</strong> Move para o elemento anterior</p>
                        <p><strong>ENTER ou ESPAÇO:</strong> Ativa botões e links</p>
                        <p><strong>ESC:</strong> Volta ao menu principal</p>
                        <p><strong>Setas:</strong> Navegar em menus e listas</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>🛠️ Funcionalidades:</h3>
                        <p><strong>Editor de Texto:</strong> Escreva e salve documentos</p>
                        <p><strong>Calculadora:</strong> Realize cálculos matemáticos</p>
                        <p><strong>Teclado Virtual:</strong> Digite usando apenas o mouse</p>
                        <p><strong>Navegador:</strong> Acesse sites da internet</p>
                    </div>
                    
                    <div class="help-section">
                        <h3>♿ Recursos de Acessibilidade:</h3>
                        <p><strong>• Foco Visual:</strong> Borda amarela destaca o elemento ativo</p>
                        <p><strong>• Feedback Sonoro:</strong> Sons confirmam ações</p>
                        <p><strong>• Alto Contraste:</strong> Melhora visibilidade</p>
                        <p><strong>• Texto Grande:</strong> Facilita leitura</p>
                        <p><strong>• Varredura Automática:</strong> Navegação sem mouse ou teclado</p>
                    </div>

                    <div class="help-section">
                        <h3>🔄 Modo de Varredura Automática:</h3>
                        <p><strong>Ativar:</strong> Vá em Configurações ou use Ctrl+S</p>
                        <p><strong>Selecionar:</strong> Pressione ENTER quando o elemento desejado estiver destacado</p>
                        <p><strong>Pausar:</strong> Pressione ESPAÇO para pausar/retomar</p>
                        <p><strong>Velocidade:</strong> Configure em Configurações (lenta, normal, rápida)</p>
                        <p><strong>Desativar:</strong> Pressione ESC ou vá em Configurações</p>
                    </div>
                </div>
            </div>

            <div id="welcome" class="welcome-content">
                <h2 class="welcome-title">Bem-vindo ao EASYFACE! 🎯</h2>
                <p class="welcome-text">
                    Esta interface foi criada especialmente para pessoas com mobilidade reduzida.<br>
                    Use o <strong>TAB</strong> para navegar e <strong>ENTER</strong> para selecionar.
                </p>
                <div class="welcome-box">
                    <h3>🚀 Comece agora:</h3>
                    <p>Pressione <strong>TAB</strong> para ir ao menu lateral e escolha uma funcionalidade!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar" id="status-bar" aria-live="polite">
        EASYFACE carregado! Use TAB para navegar pelos elementos.
    </div>

    <div id="scan-indicator" class="scan-mode-indicator" style="display: none;">
        🔄 MODO VARREDURA ATIVO - Pressione ENTER para selecionar
    </div>

    <div id="scan-controls" class="scan-controls" style="display: none;">
        <h4>🔄 Controles de Varredura</h4>
        <button class="scan-control-button" onclick="pauseScanning()" id="pause-scan" aria-label="Pausar varredura">⏸️ Pausar</button>
        <button class="scan-control-button" onclick="toggleScanMode()" aria-label="Desativar varredura">⏹ Desativar</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.min.js"></script>

    <script>
        // ===== VARIÁVEIS GLOBAIS =====
        let currentApp = 'welcome';
        let calcDisplay = '0';
        let calcExpression = '';
        let soundsEnabled = true;
        let highContrast = false;
        
        // Variáveis para varredura automática
        let scanMode = false;
        let scanInterval = null;
        let scanElements = [];
        let currentScanIndex = 0;
        let scanSpeed = 2000;
        let scanPaused = false;

        // Variáveis para navegação na calculadora
        let calcFocus = { row: 0, col: 0 };
        const calcGrid = [
            [11, 12, 13, 14],   // C, ⌫, ÷, ×
            [15, 16, 17, 18],   // 7, 8, 9, -
            [19, 20, 21, 22],   // 4, 5, 6, +
            [23, 24, 25, 26],   // 1, 2, 3, =
            [27, 27, 28, 26]    // 0 (span 2), ., = (duplicado para mapeamento)
        ];

        // Variáveis Novas Funcionalidades
        let currentPdf = null;
        let currentPage = 1;
        let pdfTotalPages = 0;
        let pdfScale = 1.5;
        let customShortcuts = {};
        let communicationPhrases = {
            saudacoes: ["Olá", "Bom dia", "Boa tarde", "Boa noite", "Tudo bem?", "Prazer em conhecê-lo"],
            necessidades: ["Estou com fome", "Estou com sede", "Preciso ir ao banheiro", "Estou com dor", "Preciso de ajuda"],
            sentimentos: ["Estou feliz", "Estou triste", "Estou cansado", "Estou com medo", "Estou com raiva"],
            emergencia: ["Preciso de ajuda urgente", "Chame um médico", "Ligue para minha família", "Não estou me sentindo bem"]
        };

        // ===== FUNÇÕES DE CONFIGURAÇÃO =====
        function loadUserSettings() {
            try {
                const saved = JSON.parse(localStorage.getItem('easyface-settings') || '{}');
                
                if (saved.fontSize) changeFontSize(saved.fontSize);
                if (saved.highContrast) toggleContrast();
                if (saved.soundsEnabled !== undefined) soundsEnabled = saved.soundsEnabled;
                if (saved.scanSpeed) scanSpeed = saved.scanSpeed;
                
                updateStatus('Configurações carregadas');
            } catch (error) {
                updateStatus('Configurações padrão aplicadas');
            }
        }

        function saveUserSettings() {
            try {
                const settings = {
                    fontSize: getCurrentFontSize(),
                    highContrast: highContrast,
                    soundsEnabled: soundsEnabled,
                    scanSpeed: scanSpeed
                };
                localStorage.setItem('easyface-settings', JSON.stringify(settings));
                updateStatus('Configurações salvas automaticamente');
            } catch (error) {
                console.log('Não foi possível salvar configurações');
            }
        }

        function getCurrentFontSize() {
            const size = parseInt(document.body.style.fontSize);
            if (size <= 16) return 'small';
            if (size <= 18) return 'medium';
            return 'large';
        }

        // ===== FUNÇÕES DE NAVEGAÇÃO =====
        function showApp(appId) {
            const apps = document.querySelectorAll('.app-container');
            apps.forEach(app => {
                app.classList.add('hidden');
            });
            
            const currentAppElement = document.getElementById(appId);
    if (currentAppElement) {
        currentAppElement.classList.remove('hidden');
    }
    currentApp = appId;
    playFeedbackSound();
        }

        function showTextEditor() { 
            showApp('text-editor'); 
        }
        
        function showCalculator() { 
            showApp('calculator-app'); 
            // Foca no botão 7 quando a calculadora é aberta
            setTimeout(() => {
                const firstNumber = document.querySelector('.calc-button[data-key="7"]');
                if (firstNumber) {
                    firstNumber.focus();
                    calcFocus = { row: 1, col: 0 }; // Posição do número 7 na grade
                    document.querySelectorAll('.calc-button').forEach(btn => {
                        btn.classList.remove('navigation-focus');
                    });
                    firstNumber.classList.add('navigation-focus');
                }
            }, 100);
        }
        
        function showVirtualKeyboard() { 
            showApp('virtual-keyboard-app'); 
        }
        
        function showSiteLauncher() { 
            showApp('site-launcher'); 
        }
        
        function showAccessibilitySettings() { 
            showApp('accessibility-settings'); 
        }
        
        function showHelp() { 
            showApp('help'); 
        }

        // ===== FUNÇÕES EXPLORADOR DE ARQUIVOS =====
        function showFileManager() {
            showApp('file-manager');
        }

        document.getElementById('file-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('file-text-area').value = e.target.result;
                    document.getElementById('file-info').textContent = `Arquivo "${file.name}" carregado com sucesso.`;
                    speakFeedback(`Arquivo ${file.name} carregado com sucesso`);
                };
                reader.readAsText(file);
            }
        });

        function saveTextFile() {
            const text = document.getElementById('file-text-area').value;
            if (text.trim()) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'documento.txt';
                a.click();
                document.getElementById('file-info').textContent = 'Arquivo salvo com sucesso!';
                speakFeedback('Arquivo salvo com sucesso');
            } else {
                document.getElementById('file-info').textContent = 'Nenhum texto para salvar.';
            }
        }

        // ===== FUNÇÕES REPRODUTOR AÚDIO =====

        function showMediaPlayer() {
            showApp('media-player');
        }

        document.getElementById('media-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const url = URL.createObjectURL(file);
                if (file.type.startsWith('audio/')) {
                    document.getElementById('audio-player').classList.remove('hidden');
                    document.getElementById('video-player').classList.add('hidden');
                    document.getElementById('audio-player').src = url;
                } else if (file.type.startsWith('video/')) {
                    document.getElementById('video-player').classList.remove('hidden');
                    document.getElementById('audio-player').classList.add('hidden');
                    document.getElementById('video-player').src = url;
                }
                document.getElementById('media-info').textContent = `Mídia "${file.name}" carregada.`;
                speakFeedback(`Mídia ${file.name} carregada`);
            }
        });

        // ===== FUNÇÕES LEITOR PDF =====

        function showPdfReader() {
            showApp('pdf-reader');
            // Inicializar PDF.js
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.12.313/pdf.worker.min.js';
        }

        document.getElementById('pdf-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                const fileReader = new FileReader();
                fileReader.onload = function() {
                    const typedarray = new Uint8Array(this.result);
                    loadPdf(typedarray);
                };
                fileReader.readAsArrayBuffer(file);
                document.getElementById('pdf-info').textContent = `PDF "${file.name}" carregado.`;
                speakFeedback(`PDF ${file.name} carregado`);
            }
        });

        function loadPdf(data) {
            pdfjsLib.getDocument(data).promise.then(function(pdf) {
                currentPdf = pdf;
                pdfTotalPages = pdf.numPages;
                currentPage = 1;
                renderPage(currentPage);
            });
        }

        function renderPage(pageNum) {
            if (!currentPdf) return;
            
            currentPdf.getPage(pageNum).then(function(page) {
                const viewport = page.getViewport({ scale: pdfScale });
                const canvas = document.getElementById('pdf-canvas');
                const context = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                
                const renderContext = {
                    canvasContext: context,
                    viewport: viewport
                };
                
                page.render(renderContext).promise.then(function() {
                    document.getElementById('pdf-info').textContent = `Página ${pageNum} de ${pdfTotalPages}`;
                    speakFeedback(`Página ${pageNum} de ${pdfTotalPages}`);
                });
            });
        }

        function prevPage() {
            if (currentPdf && currentPage > 1) {
                currentPage--;
                renderPage(currentPage);
            }
        }

        function nextPage() {
            if (currentPdf && currentPage < pdfTotalPages) {
                currentPage++;
                renderPage(currentPage);
            }
        }

        function zoomIn() {
            pdfScale += 0.25;
            if (currentPdf) renderPage(currentPage);
        }

        function zoomOut() {
            if (pdfScale > 0.5) {
                pdfScale -= 0.25;
                if (currentPdf) renderPage(currentPage);
            }
        }

        // ===== FUNÇÕES COMUNICAÇÃO ALTERNATIVA =====

        function showCommunicationAid() {
            showApp('communication-aid');
        }

        function showPhrases(category) {
            const container = document.getElementById('phrases-container');
            container.innerHTML = '';
            
            communicationPhrases[category].forEach((phrase, index) => {
                const button = document.createElement('button');
                button.className = 'phrase-button scannable';
                button.textContent = phrase;
                button.tabIndex = 50 + index;
                button.setAttribute('aria-label', `Selecionar frase: ${phrase}`);
                button.onclick = function() {
                    document.getElementById('communication-display').textContent = phrase;
                    speakFeedback(`Frase selecionada: ${phrase}`);
                };
                container.appendChild(button);
            });
        }

        function speakCommunication() {
            const text = document.getElementById('communication-display').textContent;
            if (text && text !== 'Sua mensagem aparecerá aqui...' && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                speechSynthesis.speak(utterance);
                speakFeedback('Mensagem falada');
            }
        }

        function clearCommunication() {
            document.getElementById('communication-display').textContent = 'Sua mensagem aparecerá aqui...';
            speakFeedback('Mensagem limpa');
        }

        // FUNÇÕES EMAIL-WHATSAPP

        function showEmailIntegration() {
            showApp('email-integration');
        }

        function openGmail() {
            window.open('https://mail.google.com', '_blank');
            speakFeedback('Abrindo Gmail');
        }

        function openWhatsApp() {
            window.open('https://web.whatsapp.com', '_blank');
            speakFeedback('Abrindo WhatsApp');
        }

        function sendEmail() {
            const to = document.getElementById('email-to').value;
            const subject = document.getElementById('email-subject').value;
            const body = document.getElementById('email-body').value;
            
            if (to && subject && body) {
                const mailtoLink = `mailto:${to}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
                speakFeedback('E-mail preparado para envio');
            } else {
                speakFeedback('Preencha todos os campos para enviar o e-mail');
            }
        }

        // ===== PERSONALIZAÇÃO ATALHOS =====

        function loadShortcuts() {
            try {
                const saved = JSON.parse(localStorage.getItem('easyface-shortcuts') || '{}');
                customShortcuts = saved;
                
                // Aplicar atalhos salvos
                if (saved.text) document.getElementById('shortcut-text').value = saved.text;
                if (saved.file) document.getElementById('shortcut-file').value = saved.file;
                if (saved.calc) document.getElementById('shortcut-calc').value = saved.calc;
                // Carregar outros atalhos...
            } catch (error) {
                console.log('Não foi possível carregar atalhos personalizados');
            }
        }

        function saveShortcuts() {
            try {
                customShortcuts = {
                    text: document.getElementById('shortcut-text').value,
                    file: document.getElementById('shortcut-file').value,
                    calc: document.getElementById('shortcut-calc').value,
                    // Outros atalhos...
                };
                
                localStorage.setItem('easyface-shortcuts', JSON.stringify(customShortcuts));
                updateStatus('Atalhos personalizados salvos');
                speakFeedback('Atalhos personalizados salvos');
            } catch (error) {
                console.log('Não foi possível salvar atalhos personalizados');
            }
        }

        // ===== LEITOR DE TELA =====

        function speakFeedback(message) {
            if (soundsEnabled && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);
                utterance.volume = 0.8;
                utterance.rate = 0.9;
                utterance.pitch = 1;
                speechSynthesis.speak(utterance);
            }
        }

        // ===== FUNÇÕES DO EDITOR DE TEXTO =====
        function saveText() {
            const text = document.getElementById('text-area').value;
            if (text.trim()) {
                const blob = new Blob([text], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'easyface-texto.txt';
                a.click();
                updateStatus('Texto salvo com sucesso!');
                playFeedbackSound();
            } else {
                updateStatus('Nenhum texto para salvar.');
            }
        }

        function clearText() {
            document.getElementById('text-area').value = '';
            updateStatus('Texto limpo.');
            playFeedbackSound();
        }

        function speakText() {
            const text = document.getElementById('text-area').value;
            if (text.trim() && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'pt-BR';
                speechSynthesis.speak(utterance);
                updateStatus('Lendo texto...');
            } else {
                updateStatus('Nenhum texto para ler ou recurso não disponível.');
            }
        }

        // ===== FUNÇÕES DA CALCULADORA =====
        function addToCalc(value) {
            if (calcDisplay === '0' && !isNaN(value)) {
                calcDisplay = value;
            } else {
                calcDisplay += value;
            }
            calcExpression += value;
            document.getElementById('calc-display').textContent = calcDisplay;
            playFeedbackSound();
        }

        function calculateResult() {
            if (calcExpression.trim() === '') {
                calcDisplay = '0';
                document.getElementById('calc-display').textContent = calcDisplay;
                return;
            }
            
            try {
                const expressionToEval = calcExpression
                    .replace(/×/g, '*')
                    .replace(/÷/g, '/')
                    .replace(/−/g, '-');
                
                const result = eval(expressionToEval);
                calcDisplay = result.toString();
                calcExpression = result.toString();
                document.getElementById('calc-display').textContent = calcDisplay;
            } catch (error) {
                calcDisplay = 'Erro';
                calcExpression = '';
                document.getElementById('calc-display').textContent = calcDisplay;
            }
        }

        function clearCalc() {
            calcDisplay = '0';
            calcExpression = '';
            document.getElementById('calc-display').textContent = calcDisplay;
            updateStatus('Calculadora limpa');
            playFeedbackSound();
        }

        function deleteLast() {
            if (calcDisplay.length > 1) {
                calcDisplay = calcDisplay.slice(0, -1);
                calcExpression = calcExpression.slice(0, -1);
            } else {
                calcDisplay = '0';
                calcExpression = '';
            }
            document.getElementById('calc-display').textContent = calcDisplay;
            playFeedbackSound();
        }

        // ===== SISTEMA DE NAVEGAÇÃO POR SETAS =====
        function moveCalcFocus(rowDelta, colDelta) {
            const newRow = Math.max(0, Math.min(calcFocus.row + rowDelta, calcGrid.length - 1));
            let newCol = Math.max(0, Math.min(calcFocus.col + colDelta, calcGrid[newRow].length - 1));
            
            // Ajuste especial para o botão 0 que ocupa duas colunas
            if (newRow === 4 && newCol === 1) {
                newCol = 0;
            }
            
            // Encontra o elemento a ser focado
            const tabIndex = calcGrid[newRow][newCol];
            const element = document.querySelector(`.calc-button[tabindex="${tabIndex}"]`);
            
            if (element) {
                element.focus();
                calcFocus = { row: newRow, col: newCol };
                
                // Destacar visualmente o botão com foco de navegação
                document.querySelectorAll('.calc-button').forEach(btn => {
                    btn.classList.remove('navigation-focus');
                });
                element.classList.add('navigation-focus');
            }
        }

        // ===== FUNÇÕES DO TECLADO VIRTUAL =====
        function typeKey(key) {
            const input = document.getElementById('keyboard-input');
            input.value += key;
            input.focus();
            playFeedbackSound();
        }

        function backspaceKey() {
            const input = document.getElementById('keyboard-input');
            input.value = input.value.slice(0, -1);
            playFeedbackSound();
        }

        function enterKey() {
            const input = document.getElementById('keyboard-input');
            input.value += '\n';
            playFeedbackSound();
        }

        function clearKeyboard() {
            document.getElementById('keyboard-input').value = '';
            updateStatus('Texto limpo');
            playFeedbackSound();
        }

        // ===== FUNÇÕES DO LAUNCHER DE SITE =====
        function launchSite(url) {
    window.open(url, '_blank', 'noopener,noreferrer');
    updateStatus('Site aberto em nova janela: ' + url);
    playFeedbackSound();
}

function launchCustomSite() {
    const url = document.getElementById('custom-site-url').value.trim();
    if (!url) {
        updateStatus('Por favor, digite uma URL');
        return;
    }
    
    let finalUrl = url;
    if (!url.startsWith('http://') && !url.startsWith('https://')) {
        finalUrl = 'https://' + url;
    }
    
    // Abre o site sem verificação (mais simples)
    launchSite(finalUrl);
    
    // Aviso para o usuário sobre segurança
    updateStatus('Site aberto. Cuidado com sites desconhecidos.');
}

        // ===== FUNÇÕES DE ACESSIBILIDADE =====
        function changeFontSize(size) {
            const body = document.body;
            body.classList.remove('font-small', 'font-medium', 'font-large');
            
            if (size === 'small') {
                body.style.fontSize = '16px';
                updateStatus('Fonte pequena aplicada');
            } else if (size === 'medium') {
                body.style.fontSize = '18px';
                updateStatus('Fonte média aplicada');
            } else if (size === 'large') {
                body.style.fontSize = '22px';
                updateStatus('Fonte grande aplicada');
            }
            
            saveUserSettings();
            playFeedbackSound();
        }

        function toggleContrast() {
            highContrast = !highContrast;
            if (highContrast) {
                document.body.style.filter = 'contrast(150%) brightness(110%)';
                updateStatus('Alto contraste ativado');
            } else {
                document.body.style.filter = 'none';
                updateStatus('Alto contraste desativado');
            }
            
            saveUserSettings();
            playFeedbackSound();
        }

        function toggleSounds() {
            soundsEnabled = !soundsEnabled;
            updateStatus(soundsEnabled ? 'Sons ativados' : 'Sons desativados');
            
            saveUserSettings();
            if (soundsEnabled) playFeedbackSound();
        }

        // ===== FUNÇÕES DE VARREDURA AUTOMÁTICA =====
        function toggleScanMode() {
            scanMode = !scanMode;
            const button = document.getElementById('scan-toggle');
            const indicator = document.getElementById('scan-indicator');
            const controls = document.getElementById('scan-controls');
            
            if (scanMode) {
                startScanning();
                button.textContent = '⏹️ Parar Varredura';
                button.setAttribute('aria-label', 'Parar modo de varredura automática');
                indicator.style.display = 'block';
                controls.style.display = 'block';
                updateStatus('Modo de varredura ativado - Use ENTER para selecionar');
            } else {
                stopScanning();
                button.textContent = '🔄 Ativar Varredura';
                button.setAttribute('aria-label', 'Ativar modo de varredura automática');
                indicator.style.display = 'none';
                controls.style.display = 'none';
                updateStatus('Modo de varredura desativado');
            }
            
            saveUserSettings();
        }

        function startScanning() {
            scanElements = document.querySelectorAll('.scannable:not([disabled])');
            currentScanIndex = 0;
            scanPaused = false;
            
            if (scanElements.length > 0) {
                scanInterval = setInterval(nextScanElement, scanSpeed);
                highlightCurrentElement();
            }
        }

        function stopScanning() {
            if (scanInterval) {
                clearInterval(scanInterval);
                scanInterval = null;
            }
            
            scanElements.forEach(el => el.classList.remove('scan-active'));
            scanElements = [];
            currentScanIndex = 0;
        }

        function nextScanElement() {
            if (scanPaused) return;
            
            if (scanElements[currentScanIndex]) {
                scanElements[currentScanIndex].classList.remove('scan-active');
            }
            
            currentScanIndex = (currentScanIndex + 1) % scanElements.length;
            highlightCurrentElement();
        }

        function highlightCurrentElement() {
            if (scanElements[currentScanIndex]) {
                const element = scanElements[currentScanIndex];
                element.classList.add('scan-active');
                
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                if (soundsEnabled) {
                    playDifferentSound(800);
                }
                
                const label = element.getAttribute('aria-label') || element.textContent;
                updateStatus(`Selecionando: ${label.trim()}`);
            }
        }

        function selectCurrentScanElement() {
            if (scanElements[currentScanIndex] && scanMode) {
                const element = scanElements[currentScanIndex];
                element.classList.remove('scan-active');
                element.click();
                playFeedbackSound();
                return true;
            }
            return false;
        }

        function pauseScanning() {
            scanPaused = !scanPaused;
            const button = document.getElementById('pause-scan');
            
            if (scanPaused) {
                button.textContent = '▶️ Continuar';
                updateStatus('Varredura pausada');
            } else {
                button.textContent = '⏸️ Pausar';
                updateStatus('Varredura retomada');
            }
        }

        function setScanSpeed(speed) {
            scanSpeed = speed;
            updateStatus(`Velocidade definida: ${speed/1000} segundos`);
            
            if (scanMode) {
                stopScanning();
                startScanning();
            }
            
            saveUserSettings();
        }

        // ===== FUNÇÕES DE SOM =====
        function playFeedbackSound() {
            playDifferentSound(800, 0.1);
        }

        function playErrorSound() {
            playDifferentSound(300, 0.2);
        }

        function playDifferentSound(frequency, duration = 0.1) {
            if (!soundsEnabled) return;
            
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = frequency;
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Erro ao reproduzir som');
            }
        }

        // ===== FUNÇÕES DE STATUS =====
        function updateStatus(message) {
            const statusBar = document.getElementById('status-bar');
            statusBar.textContent = message;
            statusBar.setAttribute('aria-live', 'polite');
            
            setTimeout(() => {
                if (!scanMode) {
                    statusBar.textContent = 'EASYFACE ativo - Use TAB para navegar';
                } else {
                    statusBar.textContent = 'EASYFACE - Modo varredura ativo - ENTER para selecionar';
                }
            }, 3000);
        }

        // ===== FUNÇÕES DE RECONHECIMENTO DE VOZ =====
        function checkVoiceRecognitionSupport() {
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                const voiceWarning = document.createElement('div');
                voiceWarning.className = 'alert-warning';
                voiceWarning.innerHTML = `
                    <strong>⚠️ Comando de Voz Indisponível</strong><br>
                    Seu navegador não suporta reconhecimento de voz. 
                    Recomendamos usar Google Chrome para ter acesso a todos os recursos.
                `;
                
                const settingsDiv = document.getElementById('accessibility-settings');
                if (settingsDiv) {
                    settingsDiv.appendChild(voiceWarning);
                }
                return false;
            }
            return true;
        }

        function setupVoiceRecognition() {
            if (!checkVoiceRecognitionSupport()) return;

            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            const recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;
            recognition.interimResults = false;
            
            function startVoiceCommand() {
                try {
                    recognition.start();
                    updateStatus('Escutando comando de voz... Diga: "editor", "calculadora", etc.');
                } catch (error) {
                    updateStatus('Erro ao iniciar reconhecimento de voz');
                    playErrorSound();
                }
            }
            
            recognition.onresult = function(event) {
                const command = event.results[0][0].transcript.toLowerCase().trim();
                updateStatus(`Comando reconhecido: ${command}`);
                
                if (command.includes('editor') || command.includes('texto')) {
                    showTextEditor();
                } else if (command.includes('calculadora') || command.includes('calcular')) {
                    showCalculator();
                } else if (command.includes('teclado')) {
                    showVirtualKeyboard();
                } else if (command.includes('navegador') || command.includes('internet')) {
                    showWebBrowser();
                } else if (command.includes('configurações') || command.includes('configurar')) {
                    showAccessibilitySettings();
                } else if (command.includes('ajuda') || command.includes('socorro')) {
                    showHelp();
                } else if (command.includes('varredura') || command.includes('escanear')) {
                    toggleScanMode();
                } else {
                    updateStatus('Comando não reconhecido. Tente: "editor", "calculadora", "configurações"...');
                    playErrorSound();
                }
            };
            
            recognition.onerror = function(event) {
                updateStatus('Erro no reconhecimento de voz: ' + event.error);
                playErrorSound();
            };
            
            // Adicionar botão de comando de voz
            const voiceButton = document.createElement('button');
            voiceButton.className = 'menu-button scannable';
            voiceButton.innerHTML = '🎤 Comando de Voz';
            voiceButton.onclick = startVoiceCommand;
            voiceButton.tabIndex = 90;
            voiceButton.setAttribute('aria-label', 'Ativar comando de voz - Diga o nome da funcionalidade desejada');
            document.querySelector('.sidebar').appendChild(voiceButton);
        }

        // ===== INICIALIZAÇÃO DA CALCULADORA =====
        function initCalculator() {
            const calculatorApp = document.getElementById('calculator-app');
            if (!calculatorApp) return;

            // Atualiza calcFocus quando um botão ganha foco
            document.querySelectorAll('.calc-button').forEach(button => {
                button.addEventListener('focus', function () {
                    for (let row = 0; row < calcGrid.length; row++) {
                        for (let col = 0; col < calcGrid[row].length; col++) {
                            if (calcGrid[row][col] === parseInt(this.getAttribute('tabindex'))) {
                                calcFocus = { row, col };
                                document.querySelectorAll('.calc-button').forEach(btn => btn.classList.remove('navigation-focus'));
                                this.classList.add('navigation-focus');
                                return;
                            }
                        }
                    }
                });
            });
        }

        // ===== EVENT LISTENERS GERAL (ÚNICO E CONSOLIDADO) =====
        document.addEventListener('keydown', function(e) {
            const focused = document.activeElement;
            const isCalcButtonFocused = focused && focused.classList.contains('calc-button');
            
            // Lógica de navegação da calculadora com setas e outras teclas
            if (currentApp === 'calculator-app' && isCalcButtonFocused) {
                const key = e.key;
                if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(key)) {
                    e.preventDefault();
                    if (key === 'ArrowRight') moveCalcFocus(0, 1);
                    else if (key === 'ArrowLeft') moveCalcFocus(0, -1);
                    else if (key === 'ArrowDown') moveCalcFocus(1, 0);
                    else if (key === 'ArrowUp') moveCalcFocus(-1, 0);
                    return;
                }
                
                if ('0123456789.+-*/'.includes(key)) {
                    e.preventDefault();
                    addToCalc(key);
                    return;
                } else if (key === 'Enter') {
                    e.preventDefault();
                    if (focused && focused.classList.contains('calc-button')) {
                        focused.click();
                    } else {
                        calculateResult();
                    }
                    return;
                } else if (key === 'Escape') {
                    e.preventDefault();
                    clearCalc();
                    return;
                } else if (key === 'Backspace') {
                    e.preventDefault();
                    deleteLast();
                    return;
                }
            }

            if (e.ctrlKey) {
                // Verificar atalhos personalizados primeiro
                if (customShortcuts.text && e.key === customShortcuts.text) {
                    e.preventDefault();
                    showTextEditor();
                    return;
                }
                if (customShortcuts.file && e.key === customShortcuts.file) {
                    e.preventDefault();
                    showFileManager();
                    return;
                }
                if (customShortcuts.calc && e.key === customShortcuts.calc) {
                    e.preventDefault();
                    showCalculator();
                    return;
                }
                
                // Atalhos padrão como fallback
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTextEditor();
                        break;
                    case '2':
                        e.preventDefault();
                        showFileManager();
                        break;
                    case '3':
                        e.preventDefault();
                        showCalculator();
                        break;
                    case '4':
                        e.preventDefault();
                        showVirtualKeyboard();
                        break;
                    case '5':
                        e.preventDefault();
                        showWebBrowser();
                        break;
                    case '6':
                        e.preventDefault();
                        showMediaPlayer();
                        break;
                    case '7':
                        e.preventDefault();
                        showPdfReader();
                        break;
                    case '8':
                        e.preventDefault();
                        showCommunicationAid();
                        break;
                    case '9':
                        e.preventDefault();
                        showEmailIntegration();
                        break;
                    case '0':
                        e.preventDefault();
                        showAccessibilitySettings();
                        break;
                    case 's':
                        e.preventDefault();
                        toggleScanMode();
                        break;
                }
            }

            // Lógica de varredura automática (após a calculadora)
            if (scanMode && e.key === 'Enter') {
                e.preventDefault();
                if (selectCurrentScanElement()) {
                    return;
                }
            }
            
            // ESC volta ao menu principal
            if (e.key === 'Escape') {
                if (scanMode) {
                    toggleScanMode();
                } else {
                    showApp('welcome');
                    const firstButton = document.querySelector('.menu-button');
                    if (firstButton) firstButton.focus();
                }
                e.preventDefault();
                return;
            }
            
            // Barra de espaço para pausar varredura
            if (scanMode && e.key === ' ') {
                e.preventDefault();
                pauseScanning();
                return;
            }
            
            // Atalhos de teclado para apps (Ctrl + número)
            if (e.ctrlKey) {
                switch(e.key) {
                    case '1':
                        e.preventDefault();
                        showTextEditor();
                        break;
                    case '2':
                        e.preventDefault();
                        showCalculator();
                        break;
                    case '3':
                        e.preventDefault();
                        showVirtualKeyboard();
                        break;
                    case '4':
                        e.preventDefault();
                        showWebBrowser();
                        break;
                    case '5':
                        e.preventDefault();
                        showAccessibilitySettings();
                        break;
                    case '6':
                        e.preventDefault();
                        showHelp();
                        break;
                    case 's':
                        e.preventDefault();
                        toggleScanMode();
                        break;
                }
            }
        });

        // ===== INICIALIZAÇÃO =====
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar a calculadora
            initCalculator();
        });

        window.addEventListener('load', function() {
            // Verificar e configurar reconhecimento de voz
            setupVoiceRecognition();
            
            // Carregar configurações salvas
            loadUserSettings();
            
            updateStatus('EASYFACE carregado e pronto para uso!');

            // Carregar atalhos personalizados
            loadShortcuts();
            
            // Configurar eventos para os novos inputs de arquivo
            setupFileInputs();
            
            // Foco inicial no primeiro botão do menu após um delay
            setTimeout(() => {
                if (!scanMode) {
                    const firstButton = document.querySelector('.menu-button');
                    if (firstButton) firstButton.focus();
                }
            }, 1000);
        });

        function setupFileInputs() {
            // Configurar aria-labels para inputs de arquivo
            document.getElementById('file-input').setAttribute('aria-label', 'Selecionar arquivo de texto');
            document.getElementById('media-input').setAttribute('aria-label', 'Selecionar arquivo de mídia');
            document.getElementById('pdf-input').setAttribute('aria-label', 'Selecionar arquivo PDF');
        }
    </script>
</body>
</html>